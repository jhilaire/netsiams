---
title: "Review results"
author: "Jerome Hilaire"
date: "5 Juli 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r init, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
library(dplyr)
library(tidyr)

# Categories
cat <- list()
cat[["broad"]]    <- c("Z2"="Pathways", "Z3"="Costs", "Z4"="Technology", "Z5"="Climate", "Z6"="Other")
cat[["bound"]]    <- c("H2"="2C", "H3"="1.5C", "H4"="Delay", "H5"="Socio-Econ.", "H6"="Portfolio", "H7"="Lim. Tech.")
cat[["dynamics"]] <- c("D1"="Dynamics", "D2"="Upscaling", "D3"="Residual", "D4"="Fossil fuels", "D6"="Flexibility")
cat[["costs"]]    <- c("C1"="Lower", "C3"="Burden", "C4"="Distribution", "C5"="Carbon price")
cat[["tech"]]     <- c("T1"="Versatile", "T2"="Food price", "T5"="Obstruction")
cat[["climate"]]  <- c("O1"="Overshoot", "O2"="Tipping")
cat[["other"]]    <- c("R1"="Important")

# Get data
pars       <- read.csv("data/paragraphs.csv")
note_stats <- read.csv("data/notes_statements.csv")

# Process data
pars       <- read.csv("data/paragraphs.csv", stringsAsFactors = FALSE)
note_stats <- read.csv("data/notes_statements.csv", stringsAsFactors = FALSE)
alldocs    <- readxl::read_excel("all_docs_20180529_edited_new.xlsx")

# Process data
pars       <- pars %>% select(-X) %>% 
  mutate(doc__PY=ifelse(grepl("Challenges and Opportunities for Integrated Modeling", doc__title), 2017, doc__PY)) %>% 
  mutate(doc__authors=ifelse(grepl("Challenges and Opportunities for Integrated Modeling", doc__title), "Tavoni et al", doc__authors))
# Add missing authors
pars       <- pars %>% 
  mutate(doc__authors = ifelse(doc__authors == "", unlist(sapply(doc__title, function(x) {
    sd <- stringdist::stringdist(x,alldocs$TI, method="jaccard", q=2)
    out <- alldocs$AU[which(sd == min(sd, na.rm=TRUE)[1])]
  })), doc__authors))
  
note_stats <- note_stats %>% select(-X)
all <- note_stats %>% 
  left_join(pars, by=c("id")) 

```

## Number of statements
```{r compute_nb_stat, echo=FALSE, message=FALSE, warning=FALSE}
nb_stat <- note_stats %>% 
  filter(!duplicated(docstatement__text)) %>% 
  summarise(count=n())
```
`r nb_stat$count` statements were extracted from the scenario literature.

## Number of statements by category
```{r compute_nb_stat_by_cat, echo=FALSE, message=FALSE, warning=FALSE}
nb_stat_by_cat <- note_stats %>% 
  mutate(category1=unlist(sapply(docstatement__technology__name,
                         function(x) {
                           techs <- sapply(strsplit(names(unlist(cat)), ".", fixed=TRUE), function(y) y[2])
                           out <- paste(unlist(cat))[which(substr(x,1,2) == techs)]
                           out <- ifelse(length(out)== 0, "", out)
                           return(out)
                         }))) %>% 
  mutate(category2=unlist(sapply(docstatement__technology__name,
                         function(x) {
                           techs <- sapply(strsplit(names(unlist(cat)), ".", fixed=TRUE), function(y) y[2])
                           out <- names(unlist(cat))[which(substr(x,1,2) == techs)]
                           out <- ifelse(length(out)== 0, "", out)
                           tryCatch(
                             out <- strsplit(out, ".", fixed=TRUE)[[1]][1],
                             error=function(e){
                               out <- ""
                             }  
                           )
                           
                           return(out)
                         }))) %>%            
  group_by(category1, category2) %>% 
  filter(!duplicated(docstatement__text)) %>% 
  summarise(count=n()) %>% 
  ungroup()
```




## Number of statements by category over time



```{r cars}
summary(cars)
```
